using System;
using System.Collections.Generic;
using System.Linq;

namespace BookManagementSystem
{

    public class BookNotFoundException : Exception
    {
        public BookNotFoundException(string message) : base(message)
        {
        }
    }

    public class Book
    {
        public int BookID { get; set; }
        public string Title { get; set; }
        public string Author { get; set; }
        public string Status { get; set; }
        public string Location { get; set; }
        public int BorrowCount { get; set; }

        public Book(int bookID, string title, string author, string location)
        {
            BookID = bookID;
            Title = title;
            Author = author;
            Location = location;
            Status = "New";
            BorrowCount = 0;
        }

        public void IncreaseBorrowCount()
        {
            BorrowCount++;

            if (BorrowCount < 5)
                Status = "New";
            else if (BorrowCount <= 20)
                Status = "Used";
            else
                Status = "Damaged";
        }

        public void DisplayDetails()
        {
            Console.WriteLine(
                $"BookID: {BookID}, Title: {Title}, Author: {Author}, " +
                $"Status: {Status}, Location: {Location}, BorrowCount: {BorrowCount}"
            );
        }
    }

    
    public class LibraryManager
    {
        private List<Book> books = new List<Book>();

        public void AddBook(Book book)
        {
            if (books.Any(b => b.BookID == book.BookID))
            {
                Console.WriteLine("Book ID already exists");
                return;
            }

            books.Add(book);
            Console.WriteLine("Book details added successfully");
        }

        public void DisplayAllBooks()
        {
            if (books.Count == 0)
            {
                Console.WriteLine("No books available");
                return;
            }

            foreach (var book in books)
            {
                book.DisplayDetails();
            }
        }

        public void UpdateBookById(int bookID)
        {
            if (books.Count == 0)
                throw new BookNotFoundException($"Book with ID {bookID} not found");

            Book book = books.FirstOrDefault(b => b.BookID == bookID);
            if (book == null)
                throw new BookNotFoundException($"Book with ID {bookID} not found");

            Console.WriteLine("Enter updated Title:");
            book.Title = Console.ReadLine();

            Console.WriteLine("Enter updated Author:");
            book.Author = Console.ReadLine();

            Console.WriteLine("Enter updated Location:");
            book.Location = Console.ReadLine();

            book.IncreaseBorrowCount();

            Console.WriteLine("Book details updated successfully");
        }
    }


    class Program
    {
        static void Main(string[] args)
        {
            LibraryManager manager = new LibraryManager();
            bool exit = false;

            while (!exit)
            {
                Console.WriteLine("\n1. Add Book");
                Console.WriteLine("2. Display All Books");
                Console.WriteLine("3. Update Book Details");
                Console.WriteLine("4. Exit the Program");

                if (!int.TryParse(Console.ReadLine(), out int choice))
                {
                    Console.WriteLine("Invalid choice");
                    continue;
                }

                switch (choice)
                {
                    case 1:
                        Console.WriteLine("Enter Book ID:");
                        if (!int.TryParse(Console.ReadLine(), out int id))
                        {
                            Console.WriteLine("Invalid Book ID");
                            break;
                        }

                        Console.WriteLine("Enter Title:");
                        string title = Console.ReadLine();

                        Console.WriteLine("Enter Author:");
                        string author = Console.ReadLine();

                        Console.WriteLine("Enter Location:");
                        string location = Console.ReadLine();

                        Book book = new Book(id, title, author, location);
                        manager.AddBook(book);
                        break;

                    case 2:
                        manager.DisplayAllBooks();
                        break;

                    case 3:
                        Console.WriteLine("Enter Book ID to update:");
                        if (!int.TryParse(Console.ReadLine(), out int updateId))
                        {
                            Console.WriteLine("Invalid Book ID");
                            break;
                        }

                        try
                        {
                            manager.UpdateBookById(updateId);
                        }
                        catch (BookNotFoundException ex)
                        {
                            Console.WriteLine(ex.Message);
                        }
                        break;

                    case 4:
                        Console.WriteLine("Exiting the program...");
                        exit = true;
                        break;

                    default:
                        Console.WriteLine("Invalid choice");
                        break;
                }
            }
        }
    }
}
